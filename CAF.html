<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="caf/style.css">
        <title>Conditional Access Framework - Jasper Baes</title>
    </head>
    <body>
        <div class="container-fluid container-xxl mt-4 mb-5 text-center">
            <h1 class="mb-0 mt-5 font-bold color-primary">Conditional Access <span class="font-bold color-accent bgcolor-accent-opacity px-2 py-0">Framework</span></h1>
            <p class="mt-3 mb-4 font-bold color-secondary">Make your Microsoft Cloud access watertight! ðŸ’ª</p>
            <div class="my-3 embed-responsive embed-responsive-1by1">
                <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/XXXXXXXXXX?rel=0" allowfullscreen></iframe>
            </div>
            <p class="my-5 color-secondary w-75" style="margin: auto !important">The Conditional Access Framework (CAF) is a set of 4 tools designed to streamline the creation and validation of your organization's Microsoft Cloud access strategy and policies.</p>
        </div>
        
        <div class="container-xxl mt-4 mb-5">
            <div class="row text-center">
                <div class="col color-white underline-primary me-3 p-0"><p class="py-o m-o fs-6 color-grey" style="margin-bottom: 0;">2 tools for</p><span class="fs-6 bgcolor-primary px-3 py-1 rounded my-0 font-bold">building security</span></div>
                <div class="col color-white underline-primary p-0"><p class="py-o m-o fs-6 color-grey" style="margin-bottom: 0;">2 tools for</p><span class="fs-6 bgcolor-primary px-3 py-1 rounded my-0 font-bold">verifying security</span></div>
            </div>
            <div class="row gx-3 mt-3">
                <div class="col position-relative pointer" data-bs-toggle="modal" data-bs-target="#modal1">
                    <div class="position-absolute top-0 end-0 me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up-right-square color-secondary pointer" viewBox="0 0 16 16" data-bs-toggle="modal" data-bs-target="#modal1">
                            <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                        </svg>
                    </div>
                    <div class="p-3 bg-white service">
                        <div class="text-center">
                            <span class="fs-4 color-accent font-bold me-2">#1</span><span class="fs-4 font-bold">Persona Flow Diagram</span>
                            <p class="fs-6 mt-2 color-secondary">A flow diagram to define persona access restrictions and actions effectively</p>
                            <div class="my-3 embed-responsive embed-responsive-16by9 w-100">
                                <iframe class="embed-responsive-item w-100" src="https://www.youtube.com/embed/XXXXXXXXXX?rel=0" allowfullscreen></iframe>
                            </div>
                            <a href="https://jbaes.be/CA-guide" target="_blank"><button type="button" class="btn font-bold bgcolor-primary color-white">Open Persona Flow</button></a>
                            <p class="mt-3 mb-0 fs-6 pointer" data-bs-toggle="modal" data-bs-target="#modal1">more info</p>
                        </div>
                    </div>
                </div>
                â†’
                <div class="col position-relative pointer" data-bs-toggle="modal" data-bs-target="#modal2">
                    <div class="position-absolute top-0 end-0 me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up-right-square color-secondary pointer" viewBox="0 0 16 16" data-bs-toggle="modal" data-bs-target="#modal2">
                            <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                        </svg>
                    </div>
                    <div class="p-3 bg-white service">
                        <div class="text-center">
                            <span class="fs-4 color-accent font-bold me-2">#2</span><span class="fs-4 font-bold">Persona Requirements</span>
                            <p class="fs-6 mt-2 color-secondary">An Excel template for organizing and grouping personas in Conditional Access policies</p>
                            <div class="my-3 embed-responsive embed-responsive-16by9 w-100">
                                <iframe class="embed-responsive-item w-100" src="https://www.youtube.com/embed/XXXXXXXXXX?rel=0" allowfullscreen></iframe>
                            </div>
                            <a href="https://raw.githubusercontent.com/jasperbaes/jasperbaes.github.io/main/caf/ConditionalAccessFramework-Template.xlsx" target="_blank"><button type="button" class="btn font-bold bgcolor-primary color-white">Download template</button></a>
                            <p class="mt-3 mb-0 fs-6 pointer" data-bs-toggle="modal" data-bs-target="#modal2">more info</p>
                        </div>
                    </div>
                </div>
                â†’
                <div class="col position-relative pointer" data-bs-toggle="modal" data-bs-target="#modal3">
                    <div class="position-absolute top-0 end-0 me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up-right-square color-secondary pointer" viewBox="0 0 16 16" data-bs-toggle="modal" data-bs-target="#modal3">
                            <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                        </svg>
                    </div>
                    <div class="p-3 bg-white service">
                        <div class="text-center">
                            <span class="fs-4 color-accent font-bold me-2">#3</span><span class="fs-4 font-bold">Matrix</span>
                            <p class="fs-6 mt-2 color-secondary">A per-user overview of Conditional Access policy assignments for efficient review and misconfiguration detection</p>
                            <div class="my-3 embed-responsive embed-responsive-16by9 w-100">
                                <iframe class="embed-responsive-item w-100" src="https://www.youtube.com/embed/XXXXXXXXXX?rel=0" allowfullscreen></iframe>
                            </div>
                            <a href="https://github.com/jasperbaes/Conditional-Access-Matrix" target="_blank"><button type="button" class="btn font-bold bgcolor-primary color-white">Open script</button></a>
                            <p class="mt-3 mb-0 fs-6 pointer" data-bs-toggle="modal" data-bs-target="#modal3">more info</p>
                        </div>
                    </div>
                </div>
                â†’
                <div class="col position-relative pointer" data-bs-toggle="modal" data-bs-target="#modal4">
                    <div class="position-absolute top-0 end-0 me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up-right-square color-secondary pointer" viewBox="0 0 16 16" data-bs-toggle="modal" data-bs-target="#modal4">
                            <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                        </svg>
                    </div>
                    <div class="p-3 bg-white service">
                        <div class="text-center">
                            <span class="fs-4 color-accent font-bold me-2">#4</span><span class="fs-4 font-bold">Simulator</span>
                            <p class="fs-6 mt-2 color-secondary">Simulate and validate what your access policies permit or not in both common and more malicious access situations</p>
                            <div class="my-3 embed-responsive embed-responsive-16by9 w-100">
                                <iframe class="embed-responsive-item w-100" src="https://www.youtube.com/embed/XXXXXXXXXX?rel=0" allowfullscreen></iframe>
                            </div>
                            <a href="https://security.toreon.com/docs/about" target="_blank"><button type="button" class="btn font-bold bgcolor-primary color-white">Open tool</button></a>
                            <p class="mt-3 mb-0 fs-6 pointer" data-bs-toggle="modal" data-bs-target="#modal4">more info</p>
                        </div>
                    </div>
                </div>
        </div>

        <p class="text-center mt-5 mb-0">the <span class="color-primary font-bold">Conditional Access Framework</span>, made by <a class="color-accent font-bold text-decoration-none" href="https://www.linkedin.com/in/jasper-baes" target="_blank">Jasper Baes</a></p>
        <p class="text-center mt-0 mb-3 fs-6 pointer color-grey" data-bs-toggle="modal" data-bs-target="#support">how to support?</p>
    </body>
</html>


<!-- #1 -->
<div class="modal fade" id="modal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bgcolor-primary">
          <h5 class="modal-title font-bold color-white" id="exampleModalLabel">#1 Persona Flow Diagram</h5>
          <button type="button" class="btn-close color-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>The first step in building your access security is defining what security restrictions can be applied to each persona in your environment.</p>
            <p class="color-accent font-bold mb-0 mt-2">What is a persona?</p>
            <p class="mt-0">A persona can be:</p>
            <ul>
                <li><span class="font-bold color-secondary">a group of users/identities:</span> e.g. regular users, ADM users, DEV users, external users, Entra roles, a group of Service Principals, C-level users, service accounts or non-interactive accounts <span class="color-grey">(like Entra Connect sync accounts, phone service accounts, server service accounts, meeting room service accounts, ...)</span></li>
                <li><span class="font-bold color-secondary">an individual user/identity:</span> e.g. a specific service account, a Tier 0 account, an Entra role, a Service Principal, ...</li>
            </ul>
            <p>The first step would be listing all persona in your environment.</p>
            <p class="color-accent font-bold mb-0 mt-2">What do you need to do with these personas?</p>
            <p>For each persona, you should define what access restrictions or actions can be applied. This can be done by simply following the persona flow from top to bottom (<a href="https://jbaes.be/CA-guide" target="_blank">https://jbaes.be/CA-guide</a>):</p>
            <a href="https://jbaes.be/CA-guide" target="_blank"><button type="button" class="btn bgcolor-primary color-white font-bold">Open Persona Flow</button></a>
            <p class="color-accent font-bold mb-0 mt-3">Screenshot(s)</p>
            <a href="./caf/media/CAF-flow.png" target="_blank"><img src="./caf/media/CAF-flow.png" class="img-fluid w-75 mt-3" alt="..."></a>
            <p class="color-accent font-bold mb-0 mt-3">Who needs to be involved?</p>
            <ul class="mt-0 color-secondary">
                <li>Security or IT engineer</li>
                <li>Each persona owner <span class="fs-6 color-grey">(i.e. the person or team responsible or using the persona)</span></li>
                <li>CISO <span class="fs-6 color-grey">(optional)</span></li>
            </ul>
        </div>
      </div>
    </div>
</div>

<!-- #2 -->
<div class="modal fade" id="modal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bgcolor-primary">
          <h5 class="modal-title font-bold color-white" id="exampleModalLabel">#2 Persona Requirements</h5>
          <button type="button" class="btn-close color-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>The second step in building your access security is documenting what security actions can be applied to each persona. This documentation will act as the fundamentals to build or enforce your Conditional Access policies.</p>
            <p class="color-accent font-bold mb-0 mt-2">Where do I start?</p>
            <p>Download the template here:</p>
            <a href="https://jbaes.be/CA-guide" target="_blank"><button type="button" class="btn bgcolor-accent color-white font-bold mb-3">Download template</button></a>
            <p>In this template, fill in your listed personas horizontally in the prepared cells.</p>
            <p>For each security restriction (listed vertically), mark whether it can be applied on each persona. Or the other way around: For each persona, mark if the security restrictions can be applied.</p>
            <p>For each marking, the template has whitespace for a small note. In the end, this makes it easier to group personas in Conditional Access policies. This small note can contain e.g.:</p>
            <ul>
                <li>which Operating Systems should be blocked</li>
                <li>the device Extention Attribute</li>
                <li>the device property</li>
                <li>IP (ranges)</li>
                <li>the sign-in frequency</li>
                <li>the action on a identity risk</li>
                <li>...</li>
            </ul>

            <p class="color-accent font-bold mb-0 mt-2">How will this help creating or enforcing my Conditional Access policies?</p>
            <p>With all security restrictions filled in for each persona, the next step is to group them. This guides you into creating or adjusting your Conditional Access policies. For each security restriction, you can horizontally see which personas should be included in the policy that enforces this security action.</p>
            <p>Next, create or adjust your Conditional Access policies. Based on the different security restrictions in the template, following example Conditional Access policies can be made:</p>
            <ul>
                <li>CA001 â€“ All Apps : Require MFA for All Users</li>
                <li>CA002 â€“ All Apps : Block for All Users when legacy authentication</li>
                <li>CA003 â€“ All Apps : Block  for All Users when high sign-in risk</li>
                <li>CA004 â€“ All Apps : Block  for All Users when high sign-in risk</li>
                <li>CA005 â€“ Azure mgmt : Block for non-admins</li>
                <li>CA006 â€“ All Apps : Require compliant device</li>
                <li>CA007 â€“ Some Apps : Require sign-in frequency every 8h</li>
                <li>CA008 â€“ Some Apps : Require sign-in frequency every 72h</li>
                <li>CA009 â€“ Some Apps : Require sign-in frequency every time</li>
                <li>CA010 â€“ All Apps : Require trusted location X</li>
                <li>CA011 â€“ All Apps : Require trusted location Y</li>
                <li>...</li>
            </ul>
            <p>By just adding or excluding personas to these Conditional Access policies, your organization will have a strong, clear and well-documented access security setup.</p>
            <p class="color-accent font-bold mb-0 mt-2">Who needs to be involved?</p>
            <ul class="mt-0 color-secondary">
                <li>Security or IT engineer</li>
                <li>Each persona owner <span class="fs-6 color-grey">(for validation)</span></li>
                <li>CISO <span class="fs-6 color-grey">(for final approval)</span></li>
            </ul>
        </div>
      </div>
    </div>
</div>

<!-- #3 -->
<div class="modal fade" id="modal3" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bgcolor-primary">
          <h5 class="modal-title font-bold color-white" id="exampleModalLabel">#3 Conditional Access Matrix</h5>
          <button type="button" class="btn-close color-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>Now that you have a strong Conditional Access setup, verifying is vital.</p>
            <p>The easiest but most important part of verifying Conditional Access is checking if the correct users (or personas) are assigned or excluded from a Conditional Access policy. </p>
            <p class="color-accent font-bold mb-0 mt-2">How do we verify this?</p>
            <p>To verify user/persona assignments on your Conditional Access policies, I've developed the Conditional Access Matrix. This is a script that outputs an Excel overview of all your user accounts with the Conditional Access policies they are included in or excluded from. Conditional Access policy conditions are not in scope.</p>
            <p>This Excel report allows to quickly filter and review the user accounts that are included or excluded from each of your Conditional Access policies.</p>
            <a href="https://github.com/jasperbaes/Conditional-Access-Matrix" target="_blank"><button type="button" class="btn bgcolor-accent color-white font-bold mb-3">Download script</button></a>
            <p>Beside having these insights, periodic reviews or answering questions about access becomes much easier. Example questions you need (to have) answers on:</p>
            <ul>
                <li>What user accounts are excluded from MFA?</li>
                <li>What service accounts can only access our environment from IP XXX.XXX.XXX.XXX?</li>
                <li>What user accounts are not blocked from accessing Azure Management applications?</li>
                <li>What users can use old legacy authentication methods?</li>
                <li>...</li>
            </ul>

            <p class="color-accent font-bold mb-0 mt-2">Screenshot(s)</p>
            <a href="./caf/media/matrix.png" target="_blank"><img src="./caf/media/matrix.png" class="img-fluid w-75 mt-3" alt="..."></a>

            <p class="color-accent font-bold mb-0 mt-2">Who needs to be involved?</p>
            <ul class="mt-0 color-secondary">
                <li>Security or IT engineer</li>
                <li>CISO <span class="fs-6 color-grey">(optional)</span></li>
            </ul>
        </div>
      </div>
    </div>
</div>

<!-- #4 -->
<div class="modal fade" id="modal4" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bgcolor-primary">
          <h5 class="modal-title font-bold color-white" id="exampleModalLabel">#4 Conditional Access Simulator</h5>
          <button type="button" class="btn-close color-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>Finally, you should be able to continiously verify specific access situations. The Simulator tool allows you to define these situations and simulate them on your environment.</p>
            <p class="color-accent font-bold mb-0 mt-2">The need for a Breach and Attack Simulator (BAS)</p>
            <p>Conditional Access is a complicated service to setup and maintain. It can contain many policies, which can add up or exclude eachother. Also, misconfigurations happen often resulting which can result in XXXX. Your access setup is just a translation of the policies business has defined. So you should just be checking if your Conditional Access setup meets these business defined policies.  </p>
            <p>The easiest way to do this is with compliance. For each simulation you define what the expected outcome is (e.g. MFA, company device, password reset, block, ...). If the simulation matches the expected actions, you're good. If not, you have a misconfiguration or wrong configured Conditional Access policy.</p>
            <p class="color-accent font-bold mb-0 mt-2">How to use the Conditional Access Simulator</p>
            <p>The PoC was developed during my personal time, and the tool itself was further developed and commercialized during work hours for my employer Toreon Therefore:</p>
            <p><span class="font-bold">!!</span> This tool is not open source.</p>
            <a href="https://security.toreon.com/docs/about" target="_blank"><button type="button" class="btn bgcolor-accent color-white font-bold mb-3">More info about the tool</button></a>
            <p class="color-accent font-bold mb-0 mt-2">Bonus</p>
            <p>The paid version of Conditional Access Simulator also allows to compare multiple exports of tool #3, allowing you to see which accounts were impacted during 2 points in time and for what Conditional Access policies. This makes it easier to spot accidental misconfigurations (by groups changes, user property changes, ...)</p>
            <p class="color-accent font-bold mb-0 mt-2">Screenshot(s)</p>
            <p class="color-accent font-bold mb-0 mt-2">Who needs to be involved?</p>
            <ul class="mt-0 color-secondary">
                <li>Security or IT engineer</li>
                <li>CISO</li>
            </ul>
        </div>
      </div>
    </div>
</div>

<!-- support -->
<div class="modal fade" id="support" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bgcolor-primary">
          <h5 class="modal-title font-bold color-white" id="exampleModalLabel">How to support the Conditional Access Framework?</h5>
          <button type="button" class="btn-close color-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>The Conditional Access Framework was completely made during my personal time to enhance your organization's security. If you want to do help, here's how you can contribute:</p>
            <p class="color-accent font-bold mb-0 mt-2">Talk</p>
            <p>Engage in discussions or invite me to spreak about the framework.</p>
            <p class="color-accent font-bold mb-0 mt-2">Share ideas with me</p>
            <p>Have ideas or suggestions to improve this framework? Message me on <a class="font-bold color-primary" href="https://www.linkedin.com/in/jasper-baes" target="_blank">LinkedIn</a></p>
            <p class="color-accent font-bold mb-0 mt-2">Contribute</p>
            <p>Join efforts to improve the quality, code and usability of the Conditional Access Framework.</p>
            <!-- <p class="color-accent font-bold mb-0 mt-2">Donate</p>
            <p>Consider supporting financially to cover costs (video production costs, domain name, hosting, travel, ...) or future investments: donate on â˜•<a class="font-bold color-primary" href="https://www.buymeacoffee.com/jasperbaes" target="_blank">Buy Me a Coffee</a></p> -->
        </div>
      </div>
    </div>
</div>
